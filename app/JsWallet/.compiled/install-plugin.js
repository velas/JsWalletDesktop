// Generated by LiveScript 1.6.0
(function(){
  var localStorage, ref$, keys, any, map, filter, objToPairs, install, replace, get, jsonParse, providers, eth, eth_legacy, syx, syx2, ltc, usdt, usdt_erc20, vlx_erc20, bnb, vlx_busd, busd, huobi, vlx_huobi, vlx_usdt, vlx_eth, usdc, vlx_usdc, usdt_erc20_legacy, bsc_vlx, vlx_evm_legacy, currentConfigs, pluginPairs, requiredFields, notIn, verifyPlugin, getRegistry, getPlugin, getPluginOneByOne, getInstallList, saveRegistry, addToRegistry, removeFromRegistry, buildName, installPlugins, installAllPlugins, installPlugin, uninstallPlugin, askUser, buildInstall, buildQuickInstall, buildUninstall, buildInstallByName, toString$ = {}.toString, slice$ = [].slice, out$ = typeof exports != 'undefined' && exports || this;
  localStorage = require('localStorage');
  ref$ = require('prelude-ls'), keys = ref$.keys, any = ref$.any, map = ref$.map, filter = ref$.filter, objToPairs = ref$.objToPairs;
  ref$ = require('./modal.ls'), install = ref$.install, replace = ref$.replace;
  get = require('../web3t/providers/superagent.js').get;
  jsonParse = require('./json-parse.ls');
  providers = require('./providers.ls');
  eth = require('../web3t/plugins/eth-coin.js');
  eth_legacy = require('../web3t/plugins/eth-legacy-coin.js');
  syx = require('../web3t/plugins/symblox.js');
  syx2 = require('../web3t/plugins/symblox-v2.js');
  ltc = require('../web3t/plugins/ltc-coin.js');
  usdt = require('../web3t/plugins/usdt-coin.js');
  usdt_erc20 = require('../web3t/plugins/usdt_erc20.json');
  vlx_erc20 = require('../web3t/plugins/vlx_erc20-coin.js');
  bnb = require('../web3t/plugins/bnb-coin.js');
  vlx_busd = require('../web3t/plugins/vlx_busd-coin.js');
  busd = require('../web3t/plugins/busd-coin.js');
  huobi = require('../web3t/plugins/huobi-coin.js');
  vlx_huobi = require('../web3t/plugins/vlx-huobi-coin.js');
  vlx_usdt = require('../web3t/plugins/vlx-usdt-coin.js');
  vlx_eth = require('../web3t/plugins/vlx-eth-coin.js');
  usdc = require('../web3t/plugins/usdc-coin.js');
  vlx_usdc = require('../web3t/plugins/vlx_usdc-coin.js');
  usdt_erc20_legacy = require('../web3t/plugins/usdt_erc20_legacy-coin.json');
  bsc_vlx = require('../web3t/plugins/bsc-vlx-coin.js');
  vlx_evm_legacy = require('../web3t/plugins/vlx-evm-legacy-coin.js');
  currentConfigs = {
    vlx_eth: vlx_eth,
    eth_legacy: eth_legacy,
    syx: syx,
    syx2: syx2,
    usdt: usdt,
    usdt_erc20: usdt_erc20,
    ltc: ltc,
    vlx_erc20: vlx_erc20,
    bnb: bnb,
    vlx_busd: vlx_busd,
    busd: busd,
    huobi: huobi,
    vlx_huobi: vlx_huobi,
    vlx_usdt: vlx_usdt,
    usdt_erc20_legacy: usdt_erc20_legacy,
    usdc: usdc,
    vlx_usdc: vlx_usdc,
    bsc_vlx: bsc_vlx,
    vlx_evm_legacy: vlx_evm_legacy
  };
  pluginPairs = {
    vlx_huobi: 'huobi',
    busd: 'bnb',
    vlx_erc20: 'eth',
    bsc_vlx: 'bnb'
  };
  requiredFields = ['type', 'token', 'enabled'];
  notIn = function(arr, arr2){
    return any(function(it){
      return arr2.indexOf(it) === -1;
    })(
    arr);
  };
  verifyPlugin = function(plugin, cb){
    if (toString$.call(plugin).slice(8, -1) !== 'Object') {
      return cb("Expected Object");
    }
    if (notIn(requiredFields, Object.keys(plugin))) {
      return cb("Required fields: " + requiredFields.join(', '));
    }
    return cb(null);
  };
  getRegistry = function(cb){
    var registryString, ref$;
    registryString = (ref$ = localStorage.getItem('plugin-registry')) != null ? ref$ : "[]";
    return jsonParse(registryString, cb);
  };
  getPlugin = function(name, cb){
    var coinName, item;
    coinName = name.substr("plugin-".length);
    if (currentConfigs[coinName] != null) {
      item = JSON.stringify(currentConfigs[coinName]);
    } else {
      /* try to search in local storage for custom token */
      item = localStorage.getItem(name);
      if (item == null || (item != null ? item : "").trim().length === 0) {
        console.error("[get-plugin] plugin " + name + " not found");
        return cb(null);
      }
    }
    if (toString$.call(item).slice(8, -1) !== 'String') {
      return cb(null);
    }
    return jsonParse(item, cb);
  };
  getPluginOneByOne = function(arg$, cb){
    var item, rest;
    item = arg$[0], rest = slice$.call(arg$, 1);
    if (item == null) {
      return cb(null, []);
    }
    return getPlugin(item, function(err, plugin){
      if (err != null) {
        console.error("[get-plugin-one-by-one] error:", err);
      }
      if (err != null) {
        return cb(err);
      }
      return getPluginOneByOne(rest, function(err, other){
        var all;
        if (err != null) {
          return cb(err);
        }
        all = plugin != null ? other.concat([plugin]) : other;
        return cb(null, all);
      });
    });
  };
  out$.getInstallList = getInstallList = function(cb){
    return getRegistry(function(err, data){
      if (err != null) {
        return cb(err);
      }
      return getPluginOneByOne(data, function(err, res){
        if (err != null) {
          return cb(err);
        }
        return cb(null, res);
      });
    });
  };
  saveRegistry = function(registry){
    var resultedString;
    resultedString = JSON.stringify(registry);
    return localStorage.setItem('plugin-registry', resultedString);
  };
  addToRegistry = function(name, cb){
    return getRegistry(function(err, registry){
      if (err != null) {
        return cb(err);
      }
      if (registry.indexOf(name) > -1) {
        return cb(name + " already installed");
      }
      registry.push(name);
      saveRegistry(registry);
      return cb(null);
    });
  };
  removeFromRegistry = function(name, cb){
    return getRegistry(function(err, registry){
      var index;
      if (err != null) {
        return cb(err);
      }
      index = registry.indexOf(name);
      if (index === -1) {
        return cb(null);
      }
      registry.splice(index, 1);
      saveRegistry(registry);
      return cb(null);
    });
  };
  buildName = function(token){
    return "plugin-" + token;
  };
  installPlugins = function(plugin, cb){
    var resultPlugins, rest;
    resultPlugins = (function(){
      switch (false) {
      case !(pluginPairs[plugin.token] != null && toString$.call(pluginPairs[plugin.token]).slice(8, -1) === 'Array'):
        rest = map(function(it){
          return it != null ? it[1] : void 8;
        })(
        filter(function(it){
          var ref$;
          return in$(it != null ? (ref$ = it[1]) != null ? ref$.token : void 8 : void 8, pluginPairs[plugin.token]);
        })(
        objToPairs(
        currentConfigs)));
        return [plugin].concat(rest);
      case pluginPairs[plugin.token] == null:
        return [plugin, currentConfigs[pluginPairs[plugin.token]]];
      default:
        return [plugin];
      }
    }());
    return installAllPlugins(resultPlugins, function(err){
      if (err != null) {
        return cb(err);
      }
      return cb(null);
    });
  };
  installAllPlugins = function(arg$, cb){
    var plugin, rest;
    plugin = arg$[0], rest = slice$.call(arg$, 1);
    if (plugin == null) {
      return cb(null);
    }
    return installPlugin(plugin, function(err){
      if (err != null) {
        return cb(err);
      }
      return installAllPlugins(rest, function(err){
        if (err != null) {
          return cb(err);
        }
        return cb(null);
      });
    });
  };
  out$.installPlugin = installPlugin = function(plugin, cb){
    return verifyPlugin(plugin, function(err){
      var name, body;
      if (err != null) {
        return cb(err);
      }
      plugin.canUninstall = true;
      name = buildName(plugin.token);
      body = JSON.stringify(plugin);
      localStorage.setItem(name, body);
      return addToRegistry(name, function(err){
        if (err != null) {
          console.error(err);
        }
        return cb(null);
      });
    });
  };
  uninstallPlugin = function(cweb3, token, cb){
    var name;
    if (toString$.call(token).slice(8, -1) !== 'String') {
      return cb("expected string argument");
    }
    name = buildName(token);
    return removeFromRegistry(name, function(err){
      if (err != null) {
        return cb(err);
      }
      localStorage.setItem(name, "");
      store.forceReload = true;
      return cweb3.refresh(function(){
        store.forceReload = false;
        return cb(null);
      });
    });
  };
  askUser = function(cweb3, store, plugin, cb){
    return getRegistry(function(err, registry){
      if (err != null) {
        return cb(err);
      }
      if (toString$.call(plugin).slice(8, -1) !== 'Object') {
        return cb("pluing is required");
      }
      if (toString$.call(cb).slice(8, -1) !== 'Function') {
        return cb("callback is required");
      }
      if (registry.indexOf(plugin.token) === -1) {
        return install(store, plugin, cb);
      }
      return replace(store, plugin, cb);
    });
  };
  out$.buildInstall = buildInstall = function(cweb3, store){
    return function(plugin, cb){
      if (store.current.page === 'locked') {
        return cb("Please unlock the wallet");
      }
      return verifyPlugin(plugin, function(err){
        if (err != null) {
          return cb(err);
        }
        return askUser(cweb3, store, plugin, function(err){
          if (err != null) {
            return cb(err);
          }
          return installPlugins(plugin, function(err){
            if (err != null) {
              return cb(err);
            }
            return cweb3.refresh(cb);
          });
        });
      });
    };
  };
  out$.buildQuickInstall = buildQuickInstall = function(cweb3, store){
    return function(plugin, cb){
      store.forceReload = true;
      store.forceReloadTxs = true;
      if (store.current.page === 'locked') {
        return cb("Please unlock the wallet");
      }
      return verifyPlugin(plugin, function(err){
        if (err != null) {
          return cb(err);
        }
        return installPlugins(plugin, function(err){
          if (err != null) {
            return cb(err);
          }
          return cweb3.refresh(cb);
        });
      });
    };
  };
  out$.buildUninstall = buildUninstall = function(cweb3, store){
    return function(name, cb){
      return uninstallPlugin(cweb3, name, cb);
    };
  };
  out$.buildInstallByName = buildInstallByName = function(cweb3, store){
    return function(name, cb){
      return get("https://raw.githubusercontent.com/web3space/plugin-registry/master/plugins/" + name + ".json").end(function(err, resp){
        if (err != null) {
          return cb(err);
        }
        return jsonParse(resp.text, function(err, plugin){
          if (err != null) {
            return cb(err);
          }
          if (plugin.type == null) {
            return cb("type is required");
          }
          if (plugin.enabled !== true) {
            return cb("enabled is true");
          }
          return installPlugin(plugin, function(err){
            if (err != null) {
              return cb(err);
            }
            return cweb3.refresh(cb);
          });
        });
      });
    };
  };
  function in$(x, xs){
    var i = -1, l = xs.length >>> 0;
    while (++i < l) if (x === xs[i]) return true;
    return false;
  }
}).call(this);
