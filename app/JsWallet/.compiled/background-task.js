// Generated by LiveScript 1.6.0
(function(){
  var objToPairs, tasks, addTask, escalateOneByOne, escalateTasks, startService, out$ = typeof exports != 'undefined' && exports || this, toString$ = {}.toString, slice$ = [].slice;
  objToPairs = require('prelude-ls').objToPairs;
  tasks = {};
  out$.addTask = addTask = function(id, task){
    var cb;
    cb = console.log;
    if (toString$.call(id).slice(8, -1) !== 'String') {
      return cb("id is required unique string");
    }
    if (toString$.call(task).slice(8, -1) !== 'Function') {
      return cb("task should be a function");
    }
    if (tasks[id] != null) {
      return;
    }
    return tasks[id] = task;
  };
  escalateOneByOne = function(store, arg$, cb){
    var head, tail, id, func;
    head = arg$[0], tail = slice$.call(arg$, 1);
    if (head == null) {
      return cb(null);
    }
    id = head[0], func = head[1];
    return func(store, function(err){
      if (err == null) {
        delete tasks[id];
      }
      return setImmediate(function(){
        return escalateOneByOne(store, tail, cb);
      });
    });
  };
  escalateTasks = function(store, cb){
    var taskArray;
    taskArray = objToPairs(
    tasks);
    return escalateOneByOne(store, taskArray, cb);
  };
  out$.startService = startService = function(store){
    return escalateTasks(store, function(err){
      return setTimeout(function(){
        return startService(store);
      }, 10000);
    });
  };
}).call(this);
